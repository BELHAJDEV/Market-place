{"ast":null,"code":"import _slicedToArray from\"C:/Users/Electro-Marke.ma/Documents/React-JS/market-place-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from'react';import'../contactRoom/room.css';import{useParams}from'react-router-dom';import Avatar from'@material-ui/core/Avatar';import{db}from'../../Firebase';import{SideBarContext}from'../../contexts/SideBarContext';import Zoom from'react-reveal/Zoom';import firebase from'firebase/compat';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Reply(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),sellerName=_useState2[0],setSellerName=_useState2[1];var _useContext=useContext(SideBarContext),value2=_useContext.value2,value3=_useContext.value3;var _value=_slicedToArray(value2,2),activeUser=_value[0],setActiveUser=_value[1];var _value2=_slicedToArray(value3,2),currentReceiver=_value2[0],setCurrentReceiver=_value2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),getMessages=_useState6[0],setGetMessages=_useState6[1];var _useParams=useParams(),id=_useParams.id,client=_useParams.client;var getData=function getData(){db.collection('chats').orderBy('timestamp','asc').onSnapshot(function(snapshot){return setGetMessages(snapshot.docs.map(function(doc){if(activeUser&&(// this condition for showing the seller's messages\ndoc.data().sender.toLowerCase()===activeUser.toLowerCase()&&doc.data().receiver.toLowerCase()===client.toLowerCase()&&doc.data().seller.toLowerCase()===activeUser.toLowerCase()&&doc.data().productId===id||doc.data().sender.toLowerCase()===client.toLowerCase()&&doc.data().receiver.toLowerCase()===activeUser.toLowerCase()&&doc.data().seller.toLowerCase()===activeUser.toLowerCase()&&doc.data().productId===id)){return doc.data();}else{return null;}}));});};useEffect(function(){getData();},[id,activeUser,sellerName,client]);var getReceiver=function getReceiver(){if(getMessages){getMessages.forEach(function(msg){if(msg&&msg.sender.toLowerCase()!==activeUser.toLowerCase()){if(currentReceiver===''){setCurrentReceiver(msg.sender);}}});}};var hundleChange=function hundleChange(e){setMessage(e.target.value);};var sendMessage=function sendMessage(e){e.preventDefault();if(message!==''){db.collection('chats').add({productId:id,message:message,sender:activeUser,seller:activeUser,receiver:client,timestamp:firebase.firestore.FieldValue.serverTimestamp()});}setMessage('');};return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(Zoom,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"room_container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Avatar,{alt:client,className:\"avatar\",src:\"/static/images/avatar/1.jpg\",onClick:function onClick(){}})}),/*#__PURE__*/_jsx(\"h3\",{children:client})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat\",id:\"chat\",children:getMessages&&getMessages.map(function(msg,index){if(msg){var _msg$timestamp;return/*#__PURE__*/_jsxs(\"div\",{className:msg!==null&&msg.sender.toLowerCase()===activeUser.toLowerCase()?\"message_receiver\":\"message\",children:[\"   \",/*#__PURE__*/_jsx(\"h4\",{children:msg?msg.name:null}),/*#__PURE__*/_jsx(\"p\",{children:msg?msg.message:null}),/*#__PURE__*/_jsx(\"span\",{children:msg?new Date((_msg$timestamp=msg.timestamp)===null||_msg$timestamp===void 0?void 0:_msg$timestamp.toDate()).toUTCString():null})]},index);}})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-field\",children:/*#__PURE__*/_jsxs(\"form\",{action:\"\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"\",id:\"\",placeholder:activeUser!==sellerName?\"Type a message to \".concat(sellerName):'Type a message to the Client',value:message,onChange:hundleChange}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",onClick:sendMessage,children:/*#__PURE__*/_jsx(\"i\",{className:\"far fa-paper-plane\"})})]})})]})})});}export default Reply;","map":{"version":3,"sources":["C:/Users/Electro-Marke.ma/Documents/React-JS/market-place-app/src/components/replyRoom/Reply.js"],"names":["React","useState","useEffect","useContext","useParams","Avatar","db","SideBarContext","Zoom","firebase","Reply","sellerName","setSellerName","value2","value3","activeUser","setActiveUser","currentReceiver","setCurrentReceiver","message","setMessage","getMessages","setGetMessages","id","client","getData","collection","orderBy","onSnapshot","snapshot","docs","map","doc","data","sender","toLowerCase","receiver","seller","productId","getReceiver","forEach","msg","hundleChange","e","target","value","sendMessage","preventDefault","add","timestamp","firestore","FieldValue","serverTimestamp","index","name","Date","toDate","toUTCString"],"mappings":"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","sourcesContent":["import React,{useState,useEffect,useContext} from 'react';\r\nimport '../contactRoom/room.css'\r\nimport { useParams } from 'react-router-dom';\r\nimport Avatar from '@material-ui/core/Avatar';\r\nimport {db} from '../../Firebase';\r\nimport {SideBarContext} from '../../contexts/SideBarContext';\r\nimport Zoom from 'react-reveal/Zoom';\r\nimport firebase from 'firebase/compat';\r\n\r\nfunction Reply() {\r\n    const [sellerName,setSellerName] = useState('');\r\n    const {value2,value3} = useContext(SideBarContext);\r\n    const [activeUser,setActiveUser] = value2;\r\n    const [currentReceiver,setCurrentReceiver] = value3;\r\n    const [message,setMessage] = useState('');\r\n    const [getMessages,setGetMessages] = useState([]);\r\n    \r\n    \r\n    \r\n\r\n    let {id,client} = useParams();\r\n\r\n \r\n\r\n   \r\n    \r\n    const getData = ()=>{\r\n       \r\n        db.collection('chats')\r\n        .orderBy('timestamp','asc')\r\n        .onSnapshot(snapshot => \r\n            setGetMessages(snapshot.docs.map(\r\n                \r\n                doc => {\r\n                  \r\n                    if(activeUser &&\r\n                    \r\n                        (\r\n                        // this condition for showing the seller's messages\r\n                        (doc.data().sender.toLowerCase() === activeUser.toLowerCase()\r\n                        &&\r\n                        doc.data().receiver.toLowerCase() === client.toLowerCase()\r\n                        &&\r\n                        doc.data().seller.toLowerCase() === activeUser.toLowerCase()\r\n                        \r\n                        && doc.data().productId === id\r\n                        )\r\n\r\n                        ||\r\n                        \r\n                        \r\n                        (doc.data().sender.toLowerCase() === client.toLowerCase()\r\n                        && \r\n                        doc.data().receiver.toLowerCase() === activeUser.toLowerCase()\r\n                        && \r\n                        doc.data().seller.toLowerCase() === activeUser.toLowerCase()\r\n                        \r\n                        && doc.data().productId === id \r\n                        )\r\n                        \r\n                        \r\n                        )){\r\n                            \r\n                        \r\n                        return doc.data()\r\n                    }\r\n                    else{\r\n                        return null\r\n                    }\r\n                } \r\n                \r\n        ))\r\n        \r\n        )\r\n    }\r\n    useEffect(()=>{\r\n        \r\n        getData();\r\n    \r\n        \r\n\r\n    },[id,activeUser,sellerName,client]);\r\n\r\n    \r\n\r\n    const getReceiver = ()=>{\r\n\r\n        if(getMessages){\r\n            getMessages.forEach(msg =>{\r\n                if(msg && msg.sender.toLowerCase() !== activeUser.toLowerCase()){\r\n                    if(currentReceiver === ''){\r\n                        setCurrentReceiver(msg.sender)\r\n                    }\r\n                    \r\n                    \r\n                }\r\n                \r\n            })\r\n            \r\n        }\r\n        \r\n        \r\n        \r\n    }\r\n\r\n    const hundleChange = (e)=> {\r\n        setMessage(e.target.value)\r\n\r\n    }\r\n    const sendMessage = (e)=>{\r\n        e.preventDefault();\r\n        if(message !==''){\r\n            db.collection('chats').add({\r\n                productId : id,\r\n                message,\r\n                sender : activeUser,\r\n                seller : activeUser,\r\n                receiver : client,\r\n                timestamp : firebase.firestore.FieldValue.serverTimestamp()\r\n            })\r\n        }\r\n        \r\n        setMessage('');\r\n        \r\n    }\r\n   \r\n    return (\r\n        <div className='container'>\r\n        \r\n        <Zoom>\r\n            <div className=\"room_container\">\r\n                <div className=\"header\">\r\n                    <div>\r\n                        <Avatar \r\n                                alt={client}\r\n                                className='avatar'\r\n                                src=\"/static/images/avatar/1.jpg\"\r\n                                onClick={ ()=> { \r\n                                    \r\n                                    \r\n                                    }}\r\n                        />\r\n                    </div>\r\n                    <h3>{client}</h3>\r\n                    \r\n                </div>\r\n                <div className=\"chat\" id='chat' >\r\n                   \r\n                        {getMessages && getMessages.map((msg,index) => {\r\n                                if(msg){\r\n\r\n                                \r\n                                return(\r\n                                        <div \r\n                                        \r\n                                        className={msg !== null && msg.sender.toLowerCase() === activeUser.toLowerCase() ? \"message_receiver\" : \"message\"}\r\n                                        key={index}\r\n                                        >   <h4>{msg ? msg.name :null}</h4>\r\n                                            <p>{msg ? msg.message : null}</p>\r\n                                            <span>\r\n                                            {msg ? new Date(\r\n                                            msg.timestamp?.toDate()\r\n                                            ).toUTCString()\r\n                                            :null}\r\n                                            </span>\r\n\r\n                                        </div>\r\n\r\n                                )}\r\n                            \r\n                            \r\n                        \r\n                    } )}\r\n                        \r\n\r\n                    \r\n                                \r\n                </div>\r\n                <div className=\"text-field\">\r\n                <form action=\"\">\r\n                <input type=\"text\" name=\"\" id=\"\" \r\n                    placeholder={activeUser !== sellerName ? `Type a message to ${sellerName}` : 'Type a message to the Client'} \r\n                    value={message}\r\n                    onChange={hundleChange}\r\n                    />\r\n                    <button type='submit' onClick={sendMessage}>\r\n                     <i className=\"far fa-paper-plane\"></i>\r\n\r\n                    </button>\r\n                    \r\n                </form>\r\n                    \r\n                </div>\r\n\r\n            </div>\r\n        </Zoom>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Reply\r\n"]},"metadata":{},"sourceType":"module"}