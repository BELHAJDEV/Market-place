{"ast":null,"code":"import _slicedToArray from\"C:/Users/Electro-Marke.ma/Documents/React-JS/market-place-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext,useRef}from'react';import'./room.css';import{useParams}from'react-router-dom';import Avatar from'@material-ui/core/Avatar';import{db}from'../../Firebase';import{SideBarContext}from'../../contexts/SideBarContext';import Zoom from'react-reveal/Zoom';import firebase from'firebase/compat';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Room(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),sellerName=_useState2[0],setSellerName=_useState2[1];var _useContext=useContext(SideBarContext),value2=_useContext.value2,value3=_useContext.value3;var _value=_slicedToArray(value2,2),activeUser=_value[0],setActiveUser=_value[1];var _value2=_slicedToArray(value3,2),currentReceiver=_value2[0],setCurrentReceiver=_value2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),getMessages=_useState6[0],setGetMessages=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),valid=_useState8[0],setValid=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),rec=_useState10[0],setRec=_useState10[1];var _useParams=useParams(),id=_useParams.id;useEffect(function(){db.collection('posts').doc(id).onSnapshot(function(snapshot){setSellerName(snapshot.data().username);setRec(activeUser);});},[id]);var getData=function getData(){db.collection('chats').orderBy('timestamp','asc').onSnapshot(function(snapshot){return setGetMessages(snapshot.docs.map(function(doc){if(activeUser&&(doc.data().sender.toLowerCase()===activeUser.toLowerCase()&&doc.data().productId===id||doc.data().receiver.toLowerCase()===activeUser.toLowerCase()&&doc.data().seller.toLowerCase()===doc.data().sender.toLowerCase()&&doc.data().productId===id)){return doc.data();}else{return null;}}));});};useEffect(function(){getData();},[id,activeUser,sellerName]);var hundleChange=function hundleChange(e){setMessage(e.target.value);};var sendMessage=function sendMessage(e){e.preventDefault();if(message!==''){db.collection('chats').add({productId:id,message:message,sender:activeUser,seller:sellerName,receiver:sellerName,timestamp:firebase.firestore.FieldValue.serverTimestamp()});}setMessage('');};return/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(Zoom,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"room_container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Avatar,{alt:activeUser===sellerName?\"client\":sellerName,className:\"avatar\",src:\"/static/images/avatar/1.jpg\",onClick:function onClick(){}})}),/*#__PURE__*/_jsx(\"h3\",{children:activeUser===sellerName?\"client\":sellerName})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat\",id:\"chat\",children:getMessages&&getMessages.map(function(msg,index){if(msg){var _msg$timestamp;return/*#__PURE__*/_jsxs(\"div\",{className:msg!==null&&msg.sender.toLowerCase()===activeUser.toLowerCase()?\"message_receiver\":\"message\",children:[\"   \",/*#__PURE__*/_jsx(\"h4\",{children:msg?msg.name:null}),/*#__PURE__*/_jsx(\"p\",{children:msg?msg.message:null}),/*#__PURE__*/_jsx(\"span\",{children:msg?new Date((_msg$timestamp=msg.timestamp)===null||_msg$timestamp===void 0?void 0:_msg$timestamp.toDate()).toUTCString():null})]},index);}})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-field\",children:/*#__PURE__*/_jsxs(\"form\",{action:\"\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"\",id:\"\",placeholder:activeUser!==sellerName?\"Type a message to \".concat(sellerName):'Type a message to the Client',value:message,onChange:hundleChange}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",onClick:sendMessage,children:/*#__PURE__*/_jsx(\"i\",{className:\"far fa-paper-plane\"})})]})})]})})});}export default Room;","map":{"version":3,"sources":["C:/Users/Electro-Marke.ma/Documents/React-JS/market-place-app/src/components/contactRoom/Room.js"],"names":["React","useState","useEffect","useContext","useRef","useParams","Avatar","db","SideBarContext","Zoom","firebase","Room","sellerName","setSellerName","value2","value3","activeUser","setActiveUser","currentReceiver","setCurrentReceiver","message","setMessage","getMessages","setGetMessages","valid","setValid","rec","setRec","id","collection","doc","onSnapshot","snapshot","data","username","getData","orderBy","docs","map","sender","toLowerCase","productId","receiver","seller","hundleChange","e","target","value","sendMessage","preventDefault","add","timestamp","firestore","FieldValue","serverTimestamp","msg","index","name","Date","toDate","toUTCString"],"mappings":"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","sourcesContent":["import React,{useState,useEffect,useContext,useRef} from 'react';\r\nimport './room.css';\r\nimport { useParams } from 'react-router-dom';\r\nimport Avatar from '@material-ui/core/Avatar';\r\nimport {db} from '../../Firebase';\r\nimport {SideBarContext} from '../../contexts/SideBarContext';\r\nimport Zoom from 'react-reveal/Zoom';\r\nimport firebase from 'firebase/compat';\r\n\r\n\r\n\r\n\r\nfunction Room() {\r\n    const [sellerName,setSellerName] = useState('');\r\n    const {value2,value3} = useContext(SideBarContext);\r\n    const [activeUser,setActiveUser] = value2;\r\n    const [currentReceiver,setCurrentReceiver] = value3;\r\n    const [message,setMessage] = useState('');\r\n    const [getMessages,setGetMessages] = useState([]);\r\n    const [valid,setValid] = useState(true)\r\n    const [rec,setRec] = useState('')\r\n    \r\n    \r\n\r\n    let {id} = useParams();\r\n\r\n  \r\n\r\n    useEffect(()=>{\r\n        db.collection('posts')\r\n        .doc(id).onSnapshot( snapshot => {\r\n            setSellerName(snapshot.data().username)\r\n            setRec(activeUser)\r\n              \r\n        });\r\n        \r\n        \r\n        \r\n        \r\n\r\n\r\n    },[id])\r\n    \r\n    const getData = ()=>{\r\n       \r\n        db.collection('chats')\r\n        .orderBy('timestamp','asc')\r\n        .onSnapshot(snapshot => \r\n            setGetMessages(snapshot.docs.map(\r\n                doc => {\r\n                    \r\n                    if(activeUser && \r\n                        (\r\n                        (doc.data().sender.toLowerCase() === activeUser.toLowerCase()\r\n                        &&\r\n                      \r\n                        doc.data().productId === id\r\n                        )\r\n                        ||\r\n                        (\r\n                        doc.data().receiver.toLowerCase() === activeUser.toLowerCase()\r\n                        &&\r\n                        doc.data().seller.toLowerCase() === doc.data().sender.toLowerCase()\r\n                        &&\r\n                        doc.data().productId === id\r\n                        \r\n                        )\r\n                        \r\n                        \r\n                        \r\n                        )){\r\n                            \r\n                       \r\n                        return doc.data()\r\n                    }\r\n                    else{\r\n                        return null\r\n                    }\r\n                } \r\n                \r\n        )))\r\n    }\r\n    useEffect(()=>{\r\n        \r\n        getData()\r\n        \r\n\r\n    },[id,activeUser,sellerName])\r\n\r\n\r\n\r\n\r\n    const hundleChange = (e)=> {\r\n        setMessage(e.target.value)\r\n\r\n    }\r\n    const sendMessage = (e)=>{\r\n        e.preventDefault();\r\n        if(message !==''){\r\n            db.collection('chats').add({\r\n                productId : id,\r\n                message,\r\n                sender : activeUser,\r\n                seller : sellerName,\r\n                receiver : sellerName,\r\n                timestamp : firebase.firestore.FieldValue.serverTimestamp()\r\n            })\r\n        }\r\n        \r\n        setMessage('');\r\n        \r\n    }\r\n   \r\n    return (\r\n        <div className='container'>\r\n        <Zoom>\r\n            <div className=\"room_container\">\r\n                <div className=\"header\">\r\n                    <div>\r\n                        <Avatar \r\n                                alt={activeUser === sellerName ? \"client\" : sellerName }\r\n                                className='avatar'\r\n                                src=\"/static/images/avatar/1.jpg\"\r\n                                onClick={ ()=> { \r\n                                    \r\n                                    \r\n                                    }}\r\n                        />\r\n                    </div>\r\n                    <h3>{activeUser === sellerName ? \"client\" : sellerName }</h3>\r\n                    \r\n                </div>\r\n                <div className=\"chat\" id='chat' >\r\n                   \r\n                        {getMessages && getMessages.map((msg,index) => {\r\n                            if(msg){\r\n                                return(\r\n                                        <div \r\n                                        \r\n                                        className={msg !== null && msg.sender.toLowerCase() === activeUser.toLowerCase() ? \"message_receiver\" : \"message\"}\r\n                                        key={index}\r\n                                        >   <h4>{msg ? msg.name :null}</h4>\r\n                                            <p>{msg ? msg.message : null}</p>\r\n                                            <span>\r\n                                            {msg ? new Date(\r\n                                            msg.timestamp?.toDate()\r\n                                            ).toUTCString()\r\n                                            :null}\r\n                                            </span>\r\n\r\n                                        </div>\r\n\r\n                                )}\r\n                            \r\n                            \r\n                        \r\n                    } )}\r\n                        \r\n\r\n                    \r\n                                \r\n                </div>\r\n                <div className=\"text-field\">\r\n                <form action=\"\">\r\n                <input type=\"text\" name=\"\" id=\"\" \r\n                    placeholder={activeUser !== sellerName ? `Type a message to ${sellerName}` : 'Type a message to the Client'} \r\n                    value={message}\r\n                    onChange={hundleChange}\r\n                    />\r\n                    <button type='submit' onClick={sendMessage}>\r\n                     <i className=\"far fa-paper-plane\"></i>\r\n\r\n                    </button>\r\n                    \r\n                </form>\r\n                    \r\n                </div>\r\n\r\n            </div>\r\n        </Zoom>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Room\r\n"]},"metadata":{},"sourceType":"module"}